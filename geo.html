<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Facility Locator - Dark Theme</title>
        <style>
    /* Dark theme base for the page (excluding map) */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', Arial, sans-serif;
      background: #121212; /* Dark background */
      color: #e0e0e0; /* Light text color */
    }

    /* Header with dark theme gradient */
    #header {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: #ffffff;
      padding: 24px 20px;
      text-align: center;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3);
      user-select: none;
    }

    #header h1 {
      margin: 0 0 8px 0;
      font-weight: 700;
      font-size: 2rem;
    }

    #header p {
      margin: 0;
      font-weight: 400;
      font-size: 1.1rem;
      color: #bbbbbb;
    }

    /* Controls container with dark theme */
    #controls {
      display: flex;
      justify-content: center;
      background: #1e1e1e;
      padding: 14px 10px;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px solid #333;
    }

    /* Buttons with dark theme */
    button {
      padding: 10px 24px;
      background: linear-gradient(135deg, #4a148c, #7b1fa2);
      color: #ffffff;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.25s ease;
      user-select: none;
      font-weight: 600;
      min-width: 150px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    button:hover:not(:disabled) {
      background: linear-gradient(135deg, #7b1fa2, #9c27b0);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    button:active:not(:disabled) {
      transform: translateY(0);
    }

    button:disabled {
      background: #333333;
      color: #666666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Loading spinner */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #7b1fa2;
      animation: spin 1s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Status bar */
    #status {
      text-align: center;
      background: #1e1e1e;
      color: #bbbbbb;
      font-size: 14px;
      padding: 12px 10px;
      border-bottom: 1px solid #333;
      user-select: none;
    }

    /* Map container - standard Google Maps colors */
    #map {
      height: 70vh;
      width: 100%;
    }

    /* Facility list styles for dark theme */
    #facility-list {
      background: #1e1e1e;
      max-height: 220px;
      overflow-y: auto;
      padding: 12px 16px;
      display: none;
      border-top: 1px solid #333;
      color: #e0e0e0;
      user-select: none;
    }

    .facility-item {
      padding: 10px 8px;
      border-bottom: 1px solid #333;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .facility-item:hover {
      background-color: #333333;
      color: #ffffff;
    }

    .facility-name {
      font-weight: 700;
      color: #bb86fc; /* Purple accent color */
      font-size: 1.1rem;
      user-select: text;
    }

    .facility-distance {
      font-size: 0.85rem;
      color: #aaaaaa;
      margin-top: 3px;
      user-select: text;
    }

    /* Scrollbar styling */
    #facility-list::-webkit-scrollbar {
      width: 8px;
    }

    #facility-list::-webkit-scrollbar-track {
      background: #1e1e1e;
    }

    #facility-list::-webkit-scrollbar-thumb {
      background: #4a148c;
      border-radius: 4px;
    }

    #facility-list::-webkit-scrollbar-thumb:hover {
      background: #7b1fa2;
    }
  </style>
    </head>
    <body>
        <div id="header">
            <h1>Facility Locator</h1>
            <p>Find the nearest facilities near you</p>
        </div>

        <div id="controls">
            <button id="find-btn">
                <span class="loading" id="loading-spinner"
                    style="display: none;"></span>
                Find Nearby Facilities
            </button>
            <button id="clear-btn" disabled>Clear Results</button>
        </div>

        <div id="status">Click "Find Nearby Facilities" to get started.</div>

        <div id="map"></div>

        <div id="facility-list"></div>

        <script>
    let map, userMarker, facilityMarkers = [];

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 20.5937, lng: 78.9629 }, // India center example
        zoom: 5,
        disableDefaultUI: true,
        zoomControl: true,
        mapTypeControl: true,
        streetViewControl: false,
        fullscreenControl: true
      });
    }

    window.onload = () => {
      initMap();

      const findBtn = document.getElementById("find-btn");
      const clearBtn = document.getElementById("clear-btn");
      const status = document.getElementById("status");
      const facilityList = document.getElementById("facility-list");
      const loadingSpinner = document.getElementById("loading-spinner");

      findBtn.onclick = () => {
        loadingSpinner.style.display = "inline-block";
        status.textContent = "Locating your position...";
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(position => {
            const userLoc = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };
            map.setCenter(userLoc);
            map.setZoom(14);

            // Place or move user marker
            if (!userMarker) {
              userMarker = new google.maps.Marker({
                position: userLoc,
                map: map,
                title: "You are here",
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 8,
                  fillColor: "#7b1fa2",
                  fillOpacity: 0.8,
                  strokeWeight: 2,
                  strokeColor: "#fff"
                }
              });
            } else {
              userMarker.setPosition(userLoc);
            }

            status.textContent = "Searching for nearby facilities...";
            findNearbyFacilities(userLoc);
            findBtn.disabled = true;
            clearBtn.disabled = false;
            loadingSpinner.style.display = "none";
          }, error => {
            status.textContent = "Geolocation failed or denied.";
            loadingSpinner.style.display = "none";
          }, {
            enableHighAccuracy: true,
            timeout: 10000
          });
        } else {
          status.textContent = "Geolocation is not supported by this browser.";
          loadingSpinner.style.display = "none";
        }
      };

      clearBtn.onclick = () => {
        // Clear markers
        facilityMarkers.forEach(marker => marker.setMap(null));
        facilityMarkers = [];

        if (userMarker) {
          userMarker.setMap(null);
          userMarker = null;
        }

        facilityList.style.display = "none";
        facilityList.innerHTML = "";
        status.textContent = "Results cleared. Click 'Find Nearby Facilities' to start again.";
        findBtn.disabled = false;
        clearBtn.disabled = true;
      };

      function findNearbyFacilities(location) {
        // Sample medical facilities data
        const medicalFacilities = [
          {
            name: "City General Hospital",
            lat: location.lat + 0.01,
            lng: location.lng + 0.01,
            type: "hospital"
          },
          {
            name: "24/7 Emergency Clinic",
            lat: location.lat - 0.01,
            lng: location.lng + 0.015,
            type: "emergency"
          },
          {
            name: "University Pharmacy",
            lat: location.lat + 0.02,
            lng: location.lng - 0.01,
            type: "pharmacy"
          },
          {
            name: "Community Health Center",
            lat: location.lat - 0.015,
            lng: location.lng - 0.02,
            type: "clinic"
          }
        ];

        // Clear old markers if any
        facilityMarkers.forEach(marker => marker.setMap(null));
        facilityMarkers = [];

        facilityList.innerHTML = "";
        facilityList.style.display = "block";

        medicalFacilities.forEach((facility, idx) => {
          const pos = { lat: facility.lat, lng: facility.lng };
          
          // Different icons based on facility type
          let iconUrl;
          switch(facility.type) {
            case "hospital":
              iconUrl = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
              break;
            case "emergency":
              iconUrl = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
              break;
            case "pharmacy":
              iconUrl = "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
              break;
            default:
              iconUrl = "http://maps.google.com/mapfiles/ms/icons/blue-dot.png";
          }

          const marker = new google.maps.Marker({
            position: pos,
            map: map,
            title: facility.name,
            icon: iconUrl
          });

          marker.addListener('click', () => {
            map.panTo(pos);
            map.setZoom(17);
            // Optional: Show facility info window here
          });

          facilityMarkers.push(marker);

          // Calculate distance in km from user
          const distKm = getDistanceFromLatLonInKm(location.lat, location.lng, facility.lat, facility.lng);
          const distText = distKm < 1 ? `${(distKm*1000).toFixed(0)} m` : `${distKm.toFixed(2)} km`;

          // Add to list
          const item = document.createElement("div");
          item.className = "facility-item";
          item.innerHTML = `<div class="facility-name">${facility.name}</div><div class="facility-distance">${distText} away</div>`;
          item.onclick = () => {
            map.panTo(pos);
            map.setZoom(17);
          };
          facilityList.appendChild(item);
        });

        status.textContent = `Found ${medicalFacilities.length} nearby facilities.`;
      }

      // Haversine formula to calculate distance between two lat/lng in km
      function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
        const R = 6371; // Radius of earth in km
        const dLat = deg2rad(lat2 - lat1);
        const dLon = deg2rad(lon2 - lon1);
        const a = 
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const d = R * c;
        return d;
      }

      function deg2rad(deg) {
        return deg * (Math.PI / 180);
      }
    };
  </script>

        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDN72sJpbCc3JpJBljfOSSLJXEig8MTwEs">
  </script>
    </body>
</html>
